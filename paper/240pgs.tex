%% LyX 1.3 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[english, 12pt]{article}
\usepackage{times}
%\usepackage{algorithm2e}
\usepackage{url}
\usepackage{bbm}
\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}
\usepackage{geometry}
\geometry{verbose,letterpaper,tmargin=2cm,bmargin=2cm,lmargin=1.5cm,rmargin=1.5cm}
\usepackage{rotating}
\usepackage{color}
\usepackage{graphicx}
\usepackage{amsmath, amsthm, amssymb}
\usepackage{setspace}
\usepackage{lineno}
\usepackage{hyperref}
\usepackage{bbm}
\usepackage{makecell}

%\renewcommand{\arraystretch}{1.8}

\usepackage{xr}
\externaldocument{240pgs-supp}

%\linenumbers
%\doublespacing
\onehalfspacing
%\usepackage[authoryear]{natbib}
\usepackage{natbib} \bibpunct{(}{)}{;}{author-year}{}{,}

%Pour les rajouts
\usepackage{color}
\definecolor{trustcolor}{rgb}{0,0,1}

\usepackage{dsfont}
\usepackage[warn]{textcomp}
\usepackage{adjustbox}
\usepackage{multirow}
\usepackage{graphicx}
\graphicspath{{../figures/}}
\DeclareMathOperator*{\argmin}{\arg\!\min}
\usepackage{algorithm} 
\usepackage{algpseudocode} 

\let\tabbeg\tabular
\let\tabend\endtabular
\renewenvironment{tabular}{\begin{adjustbox}{max width=0.9\textwidth}\tabbeg}{\tabend\end{adjustbox}}

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
%% Bold symbol macro for standard LaTeX users
%\newcommand{\boldsymbol}[1]{\mbox{\boldmath $#1$}}

%% Because html converters don't know tabularnewline
\providecommand{\tabularnewline}{\\}

\usepackage{babel}
\makeatother


\begin{document}


\title{Phenome-wide polygenic scores from the UK Biobank}
\author{Florian Priv\'e,$^{\text{1,}*}$ ...,$^{\text{2}}$ and Bjarni J. Vilhj\'almsson$^{\text{1,3}}$}

\date{~ }
\maketitle

\noindent$^{\text{\sf 1}}$National Centre for Register-Based Research, Aarhus University, Aarhus, 8210, Denmark. \\
\noindent$^{\text{\sf 3}}$Bioinformatics Research Centre, Aarhus University, Aarhus, 8000, Denmark. \\
\noindent$^\ast$To whom correspondence should be addressed.\\

\noindent Contact: \url{florian.prive.21@gmail.com}

\vspace*{4em}

\abstract{	
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage

\section{Introduction}

Ever larger genetic data is becoming increasingly available to researchers.
This enables deriving polygenic scores (PGS), which summarize an individual genetic components for a particular trait or disease by combining information from many genetic variants.
Polygenic scores are usually derived from summary statistics from a large meta-analysis of multiple GWAS and an ancestry-matched LD reference panel \cite[]{choi2020tutorial}. 
Yet, this is not the only way to derive polygenic scores.
Indeed, polygenic scores can be directly derived from individual-level data, i.e.\ from the genetic and phenotypic information of many individuals.
Biobank datasets such as the UK Biobank now links genetic data for half a million individuals with phenotypic data for hundreds of traits and diseases \cite[]{bycroft2018uk}.
Before having access to large genetic datasets such as the UK Biobank, using a single individual-level data to derive polygenic scores was pointless because of the small sample sizes.
It proved nevertheless useful for deriving PGS for traits with moderately large effects, such as autoimmune diseases \cite[]{abraham2014accurate,prive2019efficient}.
Yet, now that we have access to such large datasets, individual-level data can be used to derive competitive PGS for hundreds of phenotypes.

A major concern about PGS is that they usually transfer poorly to other ancestries, i.e.\ a PGS derived in people of European ancestry is not likely to predict as well in people of African ancestry.
Prediction in another ancestry has been shown to decay with genetic distance to the training population \cite[]{scutari2016using,wang2020theoretical} and with increasing proportion of admixture with a distant ancestry \cite[]{bitarello2020polygenic,cavazos2020inclusion}.
Here, we are also well positioned to reiterate this concern with strong evidence. 
Indeed, while the UKBB data contains genetic information for more than 450K British or European individuals, it also contains the same data for tens of thousands of individuals of non-British ancestry \cite[]{prive2020ancestry}.
But, even if these people genetically comes from a different ancestry, they all live in Great Britain, and had their genetic and phenotypic information derived in the same way as people of European ancestry.
This makes the UK Biobank data very well suited for comparing and evaluating predictive performance of derived PGS in diverse ancestries.

Here, we apply our fast implementation of penalized regressions \cite[]{prive2019efficient} to the UK Biobank data to derive PGS for 240 traits using the UK Biobank genetic and phenotypic data only.
As an alternative method, we also run LDpred2-auto \cite[]{prive2020ldpred2}, for which we directly derive the summary statistics from the individual-level data available.
We show that results about transferability of PGS derived from European ancestry to other ancestries are quite alarming. 
Indeed, overall for the 240 PGS, variance of the phenotypes explained by the PGS decreases by [COMPLETE].
We finally try to derive PGS by including diverse ancestries for training the models [SHOULD DO THIS?].
While some have shown including a few thousands individuals from other ancestries might be useful in the context for finding genetic-disease association, it does not seem to beneficial in the context of prediction [TO SHOW].
[ADD OTHER CONCLUSIONS]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Results}

\subsection*{Overview of methods}

\subsection*{Drop in prediction in other ancestries}

Figure \ref{fig:lasso-ancestry} presents the results when fitting penalized regressions using a training set composed of UK people and testing in 8 different ancestry groups. Averaged over around 240 phenotypes, compared to prediction performance in individuals of UK ancestry, relative predictive ability in terms of partial-$r^2$ (see Methods) is only 93.8\% in Poland, 85.6\% in Italy, 72.2\% in Iran, 64.7\% in India, 48.6\% in China, 25.2\% in the Caribbean, and 18\% in Nigeria.
Overall, relative predictive performance decreases approximately linearly with PC distance to UK (Figure \ref{fig:ratio-dist}).
As a follow-up analysis to ensure that this drop in performance for other ancestries is not due to imputation, we perform the same analysis for 83 of the continuous phenotypes using high-quality genotyped variants (see Methods) instead of the HapMap3 variants (mostly imputed); results are very similar (Figure \ref{fig:lasso-ancestry-geno}).
These results are also very similar when using LDpred2-auto instead of penalized regression for training predictive models for all phenotypes (Figure \ref{fig:ldpred2-ancestry}).
A few phenotypes deviate from this global trend; of note, prediction of bilirubin concentration is between for 0.537 and 0.619 (partial-$r$) for all ancestries except for China for which it is 0.415 (95\% CI: 0.374 - 0.453). 
In contrast, for e.g.\ hair and skin color, predictive performance decrease quickly and prediction for both China and Nigeria is not significantly different from 0, while of 0.420 (95\% CI: 0.409 - 0.432) for ``darker hair'' [SHOULD PROBABLY VERIFY HOW I DEFINE THESE PHENOTYPES] (Figure \ref{fig:lasso-ancestry}).

%% FIGURE 1 HERE
\begin{figure}[h]
\centering
\includegraphics[width=0.9\textwidth]{lasso-ancestry}
\caption{}
\label{fig:lasso-ancestry}
\end{figure}


\subsection*{Comparison of predictive models}

Penalized regression and LDpred2-auto provides approximately similar predictive performance across all traits and ancestries considered here (Figure \ref{fig:plr-ldpred2}); there are only four pairs of phenotype-ancestry (out of nearly 2000 pairs) for which 95\% CI for partial-$r$ from penalized regression and LDpred2 are not overlapping: ``615: Endometriosis'' in China with 0.065 (0.0074 - 0.122) vs -0.051 (-0.108 - 0.0068), ``hard falling asleep'' in UK with -0.0349 (-0.742 - 0.0045) vs 0.071 (0.031 - 0.110), height in UK with 0.634 (0.626 - 0.643) vs 0.613 (0.605 - 0.622), and log-bilirubin in Nigeria with 0.546 (0.523 - 0.569) vs 0.475 (0.449 - 0.500).
For prediction in UK ancestry, penalized regression tend to provide better predictive performance than LDpred2 when prediction is easy (e.g.\ partial-$r$ > 0.5) and LDpred2 tends to outperform penalized regression when predicting the phenotype is more difficult (Figure \ref{fig:plr-ldpred2}).
The sparse option in LDpred2-auto also provides similar performance as LDpred2-auto without this option (Figure \ref{fig:sparse-ldpred2}).
[TALK ABOUT SPARSITY OF RESULTING EFFECTS? COMPARE TO P?]

\subsection*{Lessons learned}

- small sample size is okay if small polygenicity

- hybrid heritability is often chosen, even if improvement in predictive performance is usually small

- comparing LDpred2 and PLR

\subsection*{Including more variants?}

- Zoomed plots

- Performance of 5M vs 1M only

\subsection*{Training using multiple ancestries}

Not better, but not worse when using the same sample size.

\subsection*{Using family history to improve genetic prediction}

We first replicate the analyses of \cite{hujoel2020liability} proposing the LT-FH method to estimate the genetic liability of individuals based on family history and to improve in GWAS.
We derived the LT-FH phenotypes for the same 12 traits for the individuals in the training set.
We then run separately a GWAS using either the case-control phenotypes or the corresponding LT-FH phenotypes.
When comparing Z-Scores obtained from the GWAS of the LT-FH phenotypes to the ones using case-control phenotypes, we report increase in power from 28\% for prostate cancer to 580\% for Alzheimer's disease (Figure \ref{fig:power-ltfh}).
This shows that the LT-FH phenotypes better capture the genetic liability of the disease compared to the case-control phenotype.

Thus, we also use these LT-FH phenotypes to train penalized regressions and see if this could improve predictive performance compare to using the case-control phenotype.
Evaluating both predictive models using the case-control status of individuals in the test set, we report non-significant improvement in predictive performance for breast cancer (174.1), type-2 diabetes (250.2) and coronary artery disease (411.4).

[HOW TO BETTER DESCRIBE FIGURES \ref{fig:lasso-ltfh} AND \ref{fig:lasso-ltfh2} + ADD CAPTIONS]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Discussion}

- How fast it is to derive polygenic scores with lasso, even for large sample sizes and number of variants [TALK ABOUT SNPNET HERE].

LIMITATIONS:
- Could use better prediction but can just combine linearly with other PGS made on external data [CITE CLARA]
- LDpred2 could not be run with 5M+ variants; we are working on this
- Better method development for prediction in other ancestries
- Discuss Doug's paper about improved heritability models for prediction

[ADD WHY THESE PGS WOULD BE USEFUL FOR RESEARCHERS / CITE PGS CATALOG + OTHER CANCER PRS-WEB.]

We show here that transferability of PGS to other populations is even worse than what has been previously reported.
Indeed, compared to three previous studies \cite[]{martin2019clinical,duncan2019analysis,wang2020theoretical}, we show a relative predictive performance compared to Europeans of 
\textasciitilde15\% for Africans (vs.\ 22\%, 42\% and 24\%), 
\textasciitilde46\% for East Asians (vs.\ 50\%, 95\% and 64\%) and 
\textasciitilde61\% for South Asians (vs.\ 60\%, 62.5\% and 72\%).
We also show that predictive performance already decrease within Europe with only \textasciitilde92.5\% for East Europe and \textasciitilde83.5\% for South Europe. 

Previous studies have shown that this reduction in performance in other ancestries is primarly due to difference in LD and allele frequencies between populations, and not so much about difference in effects / positions of causal variants \cite[]{shi2020localizing,wang2020theoretical,cavazos2020inclusion}.

[whereas
GWAS in African ancestry populations are not subject to this bias \cite[]{kim2018genetic,cavazos2020inclusion}.]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Methods}

\subsection*{Data}

[TODO: MODIFY] We have derived polygenic scores for 240 phenotypes using the UK Biobank (UKBB) data \cite[]{bycroft2018uk}.
We read dosages data from UKBB BGEN files using function \texttt{snp\_readBGEN()} of R package bigsnpr \cite[]{prive2017efficient}.
We filtered the data to 433,868 genetically homogeneous individuals, i.e.\ those with a log Mahalanobis distance from the first 16 PCs of less than 5 \cite[]{prive2020efficient}.
For the variants, we used 1.117,182 HapMap3 variants that were also present in the iPSYCH2012 data with INFO score larger than 0.3 \cite[]{pedersen2018ipsych2012}.
Even if the iPSYCH data is not used in this study, we aim to use the PGS derived here in iPSYCH in the future.

To define phenotypes, we first mapped ICD10 and ICD9 codes (UKBB fields 40001, 40002, 40006, 40013, 41202, 41270 and 41271) to phecodes using R package PheWAS \cite[]{carroll2014r,wu2019mapping}. 
We filtered down to 142 phecodes of interest that showed potential genetic signals in the PheWeb results from the SAIGE genome-wide association study in the UKBB \cite[]{zhou2018efficiently,taliun2020exploring}. We got 104 phecodes for which we could predict something using \texttt{big\_spLogReg()}.
Second, we looked closely at all 2408 UKBB fields that we had access to and filtered down to defining 111 continuous and 25 binary phenotypes.

\subsection*{Genotyped data}

For the genotyped data, we restrict to variants that have been genotyped on both chips used by the UK Biobank, that pass quality control (QC) for all batches (cf. \url{https://biobank.ctsu.ox.ac.uk/crystal/crystal/auxdata/ukb_snp_qc.txt}) and QC for possible mismappings \cite[]{kunert2020allele}, with a minor allele frequency (MAF) larger than 0.01 and imputation INFO score of 1.
There are 586,534 such high-quality variants.

\subsection*{Penalized regressions}

To derive polygenic risk scores based on individual-level data from the UKBB, we used our fast implementation of penalized linear and logistic regressions \cite[]{prive2019efficient}.
Our implementation supports for lasso and elastic-net penalizations. For the sake of simplicity and because the UKBB data is very large, we have decided to only use the lasso penalty \cite[]{prive2019efficient}.
We recall that fitting a penalized linear regression with lasso penalty corresponds to finding the vector of effects $\beta$ that minimizes
\[L(\lambda) = \underbrace{ ||y - G \beta||_2^2 }_\text{Loss function} + \underbrace{ \lambda \|\beta\|_1 }_\text{Penalisation} ~,\]
where $G$ is the genotype matrix, $y$ is the (quantitative) phenotype of interest and $\lambda$ is a hyper-parameter that needs to be chosen.

For this paper, we have extended our implementation in two ways by allowing for using different penalties for the variants (i.e.\ having $\sum_{j} \lambda_j |\beta_j|$ instead of $\lambda \|\beta\|_1$).
First, this enables us to use a different scaling for genotypes. By default, variants in $G$ are implicitly scaled. By using $\lambda_j \propto (\text{SD}_j)^{(\nu - 1)}$, this effectively scales variant $j$ by dividing it by $(\text{SD}_j)^\nu$. The default is using $\nu = 1$ but we also test $\nu = 0$ (no scaling) and $\nu = 0.5$ (Pareto scaling). We introduce a new parameter \texttt{power\_scale} for which the user can provide a vector of values to test; the best value will be chosen within the Cross-Model Selection and Averaging (CMSA) procedure \cite[]{prive2019efficient}.
We also introduce a second parameter, \texttt{power\_adaptive}, which can be used to penalize less variants with the largest marginal effects \cite[]{zou2006adaptive}; we try 3 values here (0 the default, 0.5 and 1.5) and the best one is chosen within the CMSA procedure.
[MOVE EXPLANATIONS FROM SUPP NOTE]

\subsection*{LDpred2-auto}

Using the individual-level data from the training set in the UK biobank, we run a linear regression GWAS using function \texttt{big\_univLinReg} of R package bigstatsr \cite[]{prive2017efficient}.
As LD reference, we use the one provided in \cite{prive2020ldpred2} for European ancestry.
We use these summary statistics and this LD reference as input for LDpred2-auto.
LDpred2 assumes a point-normal mixture distribution for effect sizes, where only a proportion $p$ of causal variants contributes to the heritability $h^2$.
In LDpred2-auto, these two parameters are directly estimated from the data \cite[]{prive2020ldpred2}.
We also get a vector of effects to derive the PGS, and the posterior probability of being causal for all variants.
We use the \texttt{sparse} option in LDpred2-auto to also obtain a vector of effects that is potentially sparse, i.e.\ some of the effects are exactly 0.
Also note that, as we use linear regression for all phenotypes, we use the total sample size instead of the effective sample size for binary phenotypes.
This means that heritability estimates from both LD score regression and LDpred2-auto has to be transformed to liability scale using both the prevalence in the GWAS and in the population; this can be performed using function \texttt{coef\_to\_liab} from R package bigsnpr.
For simplicity, we assume here that the prevalence in the population is the same as the prevalence in the training set from the UK Biobank we use here.

We also slightly modify the formulas used in \cite{prive2020ldpred2}; we have previously used 
\[\left(\text{se}(\hat{\gamma}_j)\right)^2 = \dfrac{(\boldsymbol{\breve{y}} - \hat{\gamma}_j \boldsymbol{\breve{G}_j})^T (\boldsymbol{\breve{y}} - \hat{\gamma}_j \boldsymbol{\breve{G}_j})}{(n - K - 1) ~ \boldsymbol{\breve{G}_j}^T \boldsymbol{\breve{G}_j}} \approx \dfrac{\boldsymbol{\breve{y}}^T \boldsymbol{\breve{y}}}{n ~ \boldsymbol{\breve{G}_j}^T \boldsymbol{\breve{G}_j}} \approx \dfrac{\text{var}(\boldsymbol{y})}{n ~ \text{var}(\boldsymbol{G_j})} ~,\]
where $\hat{\gamma}_j$ is the marginal effect of variant $j$, and where $\boldsymbol{\breve{y}}$ and $\boldsymbol{\breve{G}_j}$ are the vectors of phenotypes and genotypes for variant $j$ residualized from $K$ covariates, e.g.\ centering them.
The first approximation expects $\hat{\gamma}_j$ to be small, while the second approximation assumes that the effects from covariates are small. 
However, we found here that some variants can have very large effects, e.g.\ one variant explains about 40\% of the variance in bilirubin log-concentration.
Then, instead we compute \[(\boldsymbol{\breve{y}} - \hat{\gamma}_j \boldsymbol{\breve{G}_j})^T (\boldsymbol{\breve{y}} - \hat{\gamma}_j \boldsymbol{\breve{G}_j}) = 
\boldsymbol{\breve{y}}^T \boldsymbol{\breve{y}} 
- 2 \hat{\gamma}_j \boldsymbol{\breve{G}_j}^T \boldsymbol{\breve{y}} 
+ \hat{\gamma}_j^2 \boldsymbol{\breve{G}_j}^T \boldsymbol{\breve{G}_j} = 
\boldsymbol{\breve{y}}^T \boldsymbol{\breve{y}} 
- \hat{\gamma}_j^2 \boldsymbol{\breve{G}_j}^T \boldsymbol{\breve{G}_j} ~,\]
which now gives (note the added term $\hat{\gamma}_j^2$)
\begin{equation}\label{eq:approx-sd-lin}
\text{sd}(\boldsymbol{G_j}) \approx \dfrac{\text{sd}(\boldsymbol{\breve{y}})}{\sqrt{n ~ \text{se}(\hat{\gamma}_j)^2 + \hat{\gamma}_j^2}} ~.
\end{equation}
We now use this updated formula in the code for LDpred2, and also recommend using it for the QC procedure proposed in \cite{prive2020ldpred2}.
Figure \ref{fig:new-formula} shows that the new formula \eqref{eq:approx-sd-lin} is better.


\subsection*{Performance metric [AND COVARIATES?]}

Here we use the partial correlation as the performance metric, which is the correlation between the PGS and the phenotype after they have been both residualized using the covariates used in this paper (i.e.\ sex, age, date-of-birth, deprivation index and 16 PCs).
To derive 95\% confidence intervals for these correlations, we use Fisher's Z-transformation.
We implement this in function \texttt{pcor} of R package bigstatsr and use it here. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
%\vspace*{5em}

\section*{Software and code availability}

[TODO: EXPORT CODE FROM CLUSTER] 

All code used for this paper is available at \url{https://github.com/privefl/UKBB-PGS/tree/master/code}.
We have extensively used R packages bigstatsr and bigsnpr \cite[]{prive2017efficient} for analyzing large genetic data, packages from the future framework \cite[]{bengtsson2020unifying} for easy scheduling and parallelization of analyses on the HPC cluster, and packages from the tidyverse suite \cite[]{wickham2019welcome} for shaping and visualizing results.
We have also used R package deming to fit Deming regressions.

\section*{Acknowledgements}

Authors thank GenomeDK and Aarhus University for providing computational resources and support that contributed to these research results.
This research has been conducted using the UK Biobank Resource under Application Number 58024.

\section*{Funding}

F.P. and B.V.\ are supported by the Danish National Research Foundation (Niels Bohr Professorship to Prof. John McGrath), and also acknowledge the Lundbeck Foundation Initiative for Integrative Psychiatric Research, iPSYCH (R248-2017-2003).

\section*{Declaration of Interests}

The authors declare no competing interests.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage

\bibliographystyle{natbib}
\bibliography{refs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\end{document}
